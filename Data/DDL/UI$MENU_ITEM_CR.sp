CREATE OR ALTER PROCEDURE UI$MENU_ITEM_CR (
    I_ID INTEGER = null,
    I_PARENT INTEGER = null,
    I_FND D_NAME = null)
RETURNS (
    ID INTEGER,
    NAME VARCHAR(100),
    ITEM_TYPE VARCHAR(30),
    PARENT INTEGER,
    "BLOCK" VARCHAR(30),
    ORDER_NUM INTEGER,
    L_PARENT_NAME VARCHAR(100),
    L_ITEM_TYPE_NAME VARCHAR(100))
AS
BEGIN
  FOR
    SELECT
      T.ID,T.NAME,T.ITEM_TYPE,T.PARENT,T."BLOCK",T.ORDER_NUM,
      L_2.NAME AS L_PARENT_NAME,L_1.NAME AS L_ITEM_TYPE_NAME
    FROM UI$MENU_ITEM T 
    LEFT JOIN UI$MENU_ITEM_TYPE L_1 ON L_1.ID = T.ITEM_TYPE
    LEFT JOIN UI$MENU_ITEM L_2 ON L_2.ID = T.PARENT
    WHERE
      (T.ID = :I_ID OR :I_ID IS NULL) AND
      (:I_PARENT IS NULL OR T.PARENT = :I_PARENT) AND
      (:I_FND IS NULL OR LOWER(T.NAME) LIKE '%' || :I_FND || '%') AND
      1=1
    ORDER BY T.PARENT, T.ORDER_NUM
    INTO :ID,:NAME,:ITEM_TYPE,:PARENT,:"BLOCK",:ORDER_NUM,:L_PARENT_NAME,:L_ITEM_TYPE_NAME
  DO SUSPEND;
END

COMMENT ON PROCEDURE UI$MENU_ITEM_CR IS 
'Пункты меню';

